<!DOCTYPE html>
<html>
<head>
  <title>SCUTTLE GUI</title>
  <script src="http://beagleboard.org/static/bonescript.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.7.1/svg.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="https://people.iola.dk/olau/flot/jquery.flot.js"></script>
  <script>  
var ran = false;
setTargetAddress('192.168.7.2:8000', {initialized: run});

function run() {
  if(ran) return;
  ran = true;
  var b = require('bonescript');
  var element = SVG.get('mycircle');
  setTimeout(doRead, 100);
  
  function doRead() {
	  b.readTextFile('/sys/class/gpio/gpio69/value', onRead);
  }

	function onRead(x) {
  	if(x.err) {
		  b.writeTextFile('/sys/class/gpio/export', '69');
    } else if(x.data == 1) {
			element.fill('#f00');
    } else {
			element.fill('#0f0');
    }
	  setTimeout(doRead, 100);  
    }
	  
    var POT = 'ADC_3';

    var container = $("#myplot");
    var totalPoints = container.outerWidth() / 2 || 250;
    var data = [];
    var plotOptions = {
        series: {
            shadowSize: 0
        },
        yaxis: {
            min: 1,
            max: 0
        },
        xaxis: {
            min: 0,
            max: totalPoints,
            show: false
        }
    };
    var plot = $.plot(container, getData(), plotOptions);

    drawGraph();

    var IMUX = '/sys/bus/iio/devices/iio:device1/in_accel_x_raw';
    function drawGraph() {
    	  //console.log("drawGraph");
        plot.setData(getData());
        plot.draw();
        //b.readTextFile(IMUX, onAnalogRead);
	      b.analogRead(POT, onAnalogRead);
    }

    // Handle data back from potentiometer
    function onAnalogRead(x) {
    	//console.log("onAnalogRead");
        //if (!x.err && typeof x.value == 'number') {
            //pushData(x.data.trim());
	    pushData(x.value);
        //}
        setTimeout(drawGraph, 20);
    }

    function pushData(y) {
        if (data.length && (data.length + 1) > totalPoints) {
            data = data.slice(1);
        }
        if (data.length < totalPoints) {
            data.push(y);
        }
    }

    function getData() {
        var res = [];
        for (var i = 0; i < data.length; ++i) {
            res.push([i, data[i]]);
        }
        var series = [{
            data: res,
            lines: {
                fill: true
            }
        }];
        return series;
    }
}  
  </script>
</head>
<body>

<h1>Testing SVG functionality</h1>

<svg width="100" height="100">
   <circle id="mycircle" cx="50" cy="50" r="40" stroke="#aaa" stroke-width="4" fill="#aaa" />
   Sorry, your browser does not support inline SVG.
</svg> 
	
<h1>BoneScript Flot Demo</h1> 
<div id="myplot" style="width:500px;height:250px;"></div>
	
</body>
</html>
